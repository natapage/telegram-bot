# Sprint F4 - AI Chat Quick Start Guide

–ë—ã—Å—Ç—Ä–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é AI —á–∞—Ç–∞.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### Frontend
```bash
cd frontend
pnpm add framer-motion
```

---

## –ó–∞–ø—É—Å–∫

### 1. Backend API
```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
make api

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ uvicorn
uv run uvicorn src.api.app:app --reload --port 8000
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: http://localhost:8000

Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs

### 2. Frontend
```bash
cd frontend
pnpm dev
```

Frontend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: http://localhost:3000

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç

1. **–û—Ç–∫—Ä—ã—Ç—å dashboard**: http://localhost:3000
2. **–ù–∞–π—Ç–∏ floating button** –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É (—Å–∏–Ω—è—è –∫–Ω–æ–ø–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è)
3. **–ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É** ‚Üí –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —á–∞—Ç

### Normal Mode (–û–±—ã—á–Ω—ã–π —á–∞—Ç)

1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ä–µ–∂–∏–º: **üí¨ –û–±—ã—á–Ω—ã–π**
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
   ```
   –ü—Ä–∏–≤–µ—Ç!
   –ö–∞–∫ –¥–µ–ª–∞?
   –†–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - ‚úÖ –û—Ç–≤–µ—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –æ—Ç LLM
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
   - ‚úÖ Typing indicator —Ä–∞–±–æ—Ç–∞–µ—Ç

### Admin Mode (Text-to-SQL)

1. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º**: –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É **üìä Admin** –≤ header —á–∞—Ç–∞
2. –†–µ–∂–∏–º –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞: **üìä –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã:
   ```
   –°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –±–∞–∑–µ?
   –ü–æ–∫–∞–∂–∏ —Ç–æ–ø 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–æ–æ–±—â–µ–Ω–∏–π
   –°–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –±—ã–ª–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é?
   –ö–∞–∫–æ–π —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è?
   ```
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - ‚úÖ –û—Ç–≤–µ—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î
   - ‚úÖ SQL –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (–∫–ª–∏–∫–Ω—É—Ç—å "‚ñº SQL –∑–∞–ø—Ä–æ—Å")
   - ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ

### –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏

1. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∏–∫–æ–Ω–∫—É **üóëÔ∏è Trash** –≤ header —á–∞—Ç–∞
2. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ—á–∏—Å—Ç–∫—É
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞
   - ‚úÖ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—è–≤–∏–ª–æ—Å—å —Å–Ω–æ–≤–∞

### Persistence (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏)

1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π
2. **Refresh —Å—Ç—Ä–∞–Ω–∏—Ü—É** (F5)
3. –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç —Å–Ω–æ–≤–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å
   - ‚úÖ Session ID —Ç–æ—Ç –∂–µ (–≤ localStorage: `chat_session_id`)

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ SQL

–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–ø–∞—Å–Ω—ã–µ SQL –∫–æ–º–∞–Ω–¥—ã –≤ **Admin —Ä–µ–∂–∏–º–µ**:

```
DROP TABLE messages
DELETE FROM users WHERE id = 1
UPDATE users SET is_deleted = 1
INSERT INTO users VALUES (999, 'hacker', 0)
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ.

---

## API Endpoints (—á–µ—Ä–µ–∑ Swagger)

### 1. –ü–æ–ª—É—á–∏—Ç—å Session ID
```
GET http://localhost:8000/api/chat/session
```

–û—Ç–≤–µ—Ç:
```json
{
  "session_id": "web_550e8400-e29b-41d4-a716-446655440000"
}
```

### 2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (Normal Mode)
```
POST http://localhost:8000/api/chat/message
```

Body:
```json
{
  "message": "–ü—Ä–∏–≤–µ—Ç!",
  "mode": "normal",
  "session_id": "web_550e8400-e29b-41d4-a716-446655440000"
}
```

–û—Ç–≤–µ—Ç:
```json
{
  "message": "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —è –º–æ–≥—É –ø–æ–º–æ—á—å?",
  "sql_query": null,
  "session_id": "web_550e8400-e29b-41d4-a716-446655440000"
}
```

### 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å (Admin Mode)
```
POST http://localhost:8000/api/chat/message
```

Body:
```json
{
  "message": "–°–∫–æ–ª—å–∫–æ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –±–∞–∑–µ?",
  "mode": "admin",
  "session_id": "web_550e8400-e29b-41d4-a716-446655440000"
}
```

–û—Ç–≤–µ—Ç:
```json
{
  "message": "–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–π–¥–µ–Ω–æ 15 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤.",
  "sql_query": "SELECT COUNT(DISTINCT user_id) FROM messages WHERE is_deleted = 0",
  "session_id": "web_550e8400-e29b-41d4-a716-446655440000"
}
```

### 4. –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
```
POST http://localhost:8000/api/chat/clear
```

Body:
```json
{
  "session_id": "web_550e8400-e29b-41d4-a716-446655440000"
}
```

–û—Ç–≤–µ—Ç:
```json
{
  "status": "ok",
  "message": "Chat history cleared"
}
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Frontend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
**–û—à–∏–±–∫–∞**: `Cannot find module 'framer-motion'`

**–†–µ—à–µ–Ω–∏–µ**:
```bash
cd frontend
pnpm add framer-motion
```

### –ü—Ä–æ–±–ª–µ–º–∞: Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
**–û—à–∏–±–∫–∞**: `–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞`

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `.env` —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –Ω—É–∂–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
```bash
TELEGRAM_BOT_TOKEN=your_token
OPENAI_API_KEY=your_key
SYSTEM_PROMPT="–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç"
```

### –ü—Ä–æ–±–ª–µ–º–∞: LLM –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
**–û—à–∏–±–∫–∞**: Timeout –∏–ª–∏ "Failed to send message"

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `OPENAI_API_KEY` –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `OPENAI_BASE_URL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: https://openrouter.ai/api/v1)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend: `logs/`

### –ü—Ä–æ–±–ª–µ–º–∞: SQL –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
**–û—à–∏–±–∫–∞**: "Generated SQL query is not safe"

**–†–µ—à–µ–Ω–∏–µ**: –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–æ–ª—å–∫–æ SELECT –∑–∞–ø—Ä–æ—Å—ã.

### –ü—Ä–æ–±–ª–µ–º–∞: –ò—Å—Ç–æ—Ä–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
1. Session ID –≤ localStorage –±—Ä–∞—É–∑–µ—Ä–∞ (`chat_session_id`)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞: `telegram_bot.db`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
cd frontend
pnpm list framer-motion
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é.

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend
```bash
curl http://localhost:8000/health
```

–û—Ç–≤–µ—Ç:
```json
{"status": "ok", "service": "dashboard-api"}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å frontend
–û—Ç–∫—Ä—ã—Ç—å: http://localhost:3000

–î–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è dashboard —Å floating button.

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ backend
```bash
tail -f logs/*.log
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ë–î
```bash
sqlite3 telegram_bot.db "SELECT * FROM users LIMIT 5;"
sqlite3 telegram_bot.db "SELECT * FROM messages WHERE user_id > 1000000 LIMIT 5;"
```

### –û—á–∏—Å—Ç–∫–∞ session storage (–≤ –±—Ä–∞—É–∑–µ—Ä–µ)
**DevTools ‚Üí Application ‚Üí Local Storage ‚Üí localhost:3000**

–£–¥–∞–ª–∏—Ç—å –∫–ª—é—á: `chat_session_id`

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. ‚úÖ –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å PR –¥–ª—è review
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞
4. ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å Sprint F5

---

**–£–¥–∞—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è! üöÄ**
