# Функциональные требования к дашборду статистики

> **Назначение**: Определение функциональных требований к интерфейсу дашборда статистики диалогов
> **Версия**: 1.0
> **Дата**: 2025-10-17

---

## Обзор

Дашборд предоставляет визуализацию статистики по диалогам Telegram-бота, включая общие метрики, графики активности, список последних диалогов и топ активных пользователей.

---

## Фильтрация по периодам

Пользователь может выбрать период для просмотра статистики:

- **День (day)** - статистика за последние 24 часа
- **Неделя (week)** - статистика за последние 7 дней
- **Месяц (month)** - статистика за последние 30 дней

Фильтр применяется ко всем компонентам дашборда одновременно.

---

## Компоненты дашборда

### 1. Общая статистика (Overall Stats)

**Назначение**: Отображение ключевых метрик в виде карточек

**Метрики**:

| Метрика | Описание | Формат |
|---------|----------|--------|
| **Всего диалогов** | Количество уникальных пользователей, которые отправили хотя бы одно сообщение за период | Целое число |
| **Активных пользователей** | Количество пользователей, которые были активны за период | Целое число |
| **Средняя длина диалога** | Среднее количество сообщений на диалог за период | Дробное число (1 знак после запятой) |

**Примечания**:
- Учитываются только не удаленные сообщения (`is_deleted = 0`)
- Считаются сообщения всех типов (user, assistant, system)

---

### 2. График активности по времени (Activity Chart)

**Назначение**: Визуализация динамики активности пользователей во времени

**Характеристики**:

| Период | Ось X | Количество точек | Описание |
|--------|-------|------------------|----------|
| **День** | Часы (0-23) | 24 | Активность по часам за последние 24 часа |
| **Неделя** | Дни недели | 7 | Активность по дням за последнюю неделю |
| **Месяц** | Даты | 30 | Активность по дням за последний месяц |

**Данные для каждой точки**:
- `timestamp` - временная метка (ISO 8601 формат)
- `message_count` - количество сообщений в этот период

**Примечания**:
- График показывает количество сообщений (не пользователей)
- Учитываются только сообщения пользователей (`role = 'user'`)

---

### 3. Список последних диалогов (Recent Dialogs)

**Назначение**: Отображение последних активных диалогов с пользователями

**Характеристики**:
- Отображается **10 последних диалогов**
- Сортировка по дате последнего сообщения (от новых к старым)

**Данные для каждого диалога**:

| Поле | Описание | Формат |
|------|----------|--------|
| **user_id** | ID пользователя Telegram | Целое число |
| **last_message** | Превью последнего сообщения (первые 100 символов) | Строка |
| **created_at** | Дата начала диалога (первое сообщение) | ISO 8601 (YYYY-MM-DD HH:MM:SS) |
| **message_count** | Количество сообщений в диалоге | Целое число |

**Примечания**:
- Учитываются только не удаленные диалоги
- Если диалог длиннее 100 символов, добавляется "..."

---

### 4. Топ пользователей по активности (Top Users)

**Назначение**: Отображение самых активных пользователей за период

**Характеристики**:
- Отображается **5 самых активных пользователей**
- Сортировка по количеству сообщений (от большего к меньшему)

**Данные для каждого пользователя**:

| Поле | Описание | Формат |
|------|----------|--------|
| **user_id** | ID пользователя Telegram | Целое число |
| **message_count** | Количество сообщений пользователя за период | Целое число |
| **last_active** | Дата последней активности | ISO 8601 (YYYY-MM-DD HH:MM:SS) |

**Примечания**:
- Учитываются только сообщения пользователя (`role = 'user'`)
- Не учитываются удаленные сообщения

---

## Требования к данным

### Точность данных
- Все временные метки в UTC
- Все числовые значения не должны быть отрицательными
- При отсутствии данных возвращаются нулевые значения (не null)

### Производительность
- Время ответа API < 500ms для любого периода
- Данные должны быть готовы к отображению без дополнительной обработки на фронтенде

### Валидация
- Период должен быть одним из: "day", "week", "month"
- При неверном периоде возвращается ошибка 400

---

## Референсы

**UI дизайн**: [shadcn/ui Dashboard-01](https://ui.shadcn.com/blocks#dashboard-01)

**Связанные документы**:
- [API Contract Example](./api-contract-example.json) - пример структуры JSON ответа
- [Frontend Roadmap](./frontend-roadmap.md) - план развития frontend

---

## Примечания для разработчиков

### Ограничения текущей реализации (MVP)
- Нет фильтрации по конкретным пользователям
- Нет экспорта данных
- Нет сравнения периодов
- Нет real-time обновлений

### Будущие улучшения (Future sprints)
- Детальная информация по каждому диалогу (drill-down)
- Фильтры по типам сообщений
- Графики распределения длины сообщений
- Анализ тональности сообщений (sentiment analysis)
- Экспорт статистики в CSV/Excel

---

**Статус**: Утверждено
**Последнее обновление**: 2025-10-17
