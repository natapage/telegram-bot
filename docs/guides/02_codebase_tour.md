# Codebase Tour

–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–æ–¥—É: –≥–¥–µ —á—Ç–æ –ª–µ–∂–∏—Ç –∏ –∑–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegram-bot/
‚îú‚îÄ‚îÄ src/                    # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ main.py            # üöÄ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ bot.py             # ü§ñ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è aiogram
‚îÇ   ‚îú‚îÄ‚îÄ handler.py         # üì® –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ llm_client.py      # üß† LLM API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ dialog_manager.py  # üí¨ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π
‚îú‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py        # –û–±—â–∏–µ fixtures
‚îÇ   ‚îú‚îÄ‚îÄ unit/              # Unit-—Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ integration/       # Integration-—Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ prompts/               # –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ music_consultant.txt
‚îú‚îÄ‚îÄ docs/                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ guides/            # –ì–∞–π–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ tasklists/         # –ü–ª–∞–Ω—ã —Ä–∞–±–æ—Ç –ø–æ —Å–ø—Ä–∏–Ω—Ç–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ vision.md          # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –≤–∏–¥–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ roadmap.md         # Roadmap –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ logs/                  # –õ–æ–≥–∏ (–≤ .gitignore)
‚îú‚îÄ‚îÄ .env                   # –°–µ–∫—Ä–µ—Ç—ã (–≤ .gitignore)
‚îú‚îÄ‚îÄ .env.example           # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ pyproject.toml         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ Makefile               # –ö–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ README.md              # –û—Å–Ω–æ–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
```

## –ö–∞—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π

```mermaid
graph LR
    main[main.py] --> config[config.py]
    main --> bot[bot.py]
    main --> handler[handler.py]
    main --> llm[llm_client.py]
    main --> dm[dialog_manager.py]

    bot --> config
    handler --> llm
    handler --> dm
    llm --> config
    dm --> config

    style main fill:#FF5722,stroke:#D84315,stroke-width:3px,color:#fff
    style config fill:#607D8B,stroke:#455A64,stroke-width:2px,color:#fff
    style bot fill:#4CAF50,stroke:#388E3C,stroke-width:2px,color:#fff
    style handler fill:#FF9800,stroke:#F57C00,stroke-width:2px,color:#fff
    style llm fill:#E91E63,stroke:#C2185B,stroke-width:2px,color:#fff
    style dm fill:#9C27B0,stroke:#7B1FA2,stroke-width:2px,color:#fff
```

## src/ - –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥

### main.py (72 —Å—Ç—Ä–æ–∫–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
- `setup_logging(config)` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ structlog
- `async main()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å Config
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –°–æ–∑–¥–∞—Ç—å Bot, LLMClient, DialogManager, MessageHandler
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å polling

**–ó–∞–ø—É—Å–∫**: `python -m src.main`

---

### config.py (82 —Å—Ç—Ä–æ–∫–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ `.env`

**–ö–ª–∞—Å—Å**: `Config`

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:
- `__init__()` - –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `_get_required(key)` - –ø–æ–ª—É—á–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä (Fail Fast)
- `_load_system_prompt()` - –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ env

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```python
TELEGRAM_BOT_TOKEN: str          # –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
OPENAI_API_KEY: str              # –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
SYSTEM_PROMPT: str               # –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ env
OPENAI_BASE_URL: str             # default: openrouter
OPENAI_MODEL: str                # default: gpt-4
BOT_ROLE_NAME: str               # default: "–ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç"
BOT_ROLE_DESCRIPTION: str        # default: "–ü–æ–º–æ–≥–∞—é..."
LOG_LEVEL: str                   # default: "INFO"
LOG_FILE_PATH: str               # default: "logs/"
MAX_CONTEXT_MESSAGES: int        # default: 0 (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏**:
- –î–æ–±–∞–≤–ª—è—è –Ω–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –æ–±–Ω–æ–≤–∏—Ç—å `__init__()` –∏ `.env.example`
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_get_required()`
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `os.getenv(key, default)`

---

### bot.py (25 —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è aiogram Bot –∏ Dispatcher

**–ö–ª–∞—Å—Å**: `Bot`

**–ú–µ—Ç–æ–¥—ã**:
- `__init__(config)` - —Å–æ–∑–¥–∞–Ω–∏–µ aiogram.Bot –∏ Dispatcher
- `async start()` - –∑–∞–ø—É—Å–∫ polling

**–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ aiogram

---

### handler.py (105 —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π Telegram

**–ö–ª–∞—Å—Å**: `MessageHandler`

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: LLMClient, DialogManager, Logger

**–ú–µ—Ç–æ–¥—ã-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**:
- `handle_start(message)` - –∫–æ–º–∞–Ω–¥–∞ `/start`
- `handle_role(message)` - –∫–æ–º–∞–Ω–¥–∞ `/role`
- `handle_clear(message)` - –∫–æ–º–∞–Ω–¥–∞ `/clear`
- `handle_text(message)` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: `_register_handlers()` —Å–≤—è–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã —Å –∫–æ–º–∞–Ω–¥–∞–º–∏/—Ñ–∏–ª—å—Ç—Ä–∞–º–∏

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
```python
try:
    # —Ä–∞–±–æ—Ç–∞ —Å LLM
except Exception as e:
    logger.error("llm_error", ...)
    await message.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞...")
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏**:
- –î–æ–±–∞–≤–ª—è—è –∫–æ–º–∞–Ω–¥—É: —Å–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ + –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `_register_handlers()`
- –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—è—Ç—å `message.text` –∏ `message.from_user` –Ω–∞ None

---

### llm_client.py (59 —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å LLM —á–µ—Ä–µ–∑ OpenAI API

**–ö–ª–∞—Å—Å**: `LLMClient`

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: Config, Logger

**–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥**:
```python
async def generate_response(messages: list[dict]) -> str:
    # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å
    # –í—ã–∑–≤–∞—Ç—å client.chat.completions.create()
    # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏ (OpenAIError, TimeoutError)
    # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç
    # –í–µ—Ä–Ω—É—Ç—å content
```

**API –∫–ª–∏–µ–Ω—Ç**:
```python
self.client = AsyncOpenAI(
    base_url=config.OPENAI_BASE_URL,
    api_key=config.OPENAI_API_KEY
)
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏**:
- –°–º–µ–Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: –∏–∑–º–µ–Ω–∏—Ç—å `OPENAI_BASE_URL` –≤ .env
- –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã API: –¥–æ–±–∞–≤–∏—Ç—å –≤ `create()` call
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å + re-raise

---

### dialog_manager.py (91 —Å—Ç—Ä–æ–∫–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –ø–∞–º—è—Ç–∏

**–ö–ª–∞—Å—Å**: `DialogManager`

**–•—Ä–∞–Ω–∏–ª–∏—â–µ**:
```python
dialogs: dict[int, list[dict[str, Any]]] = {}
# {user_id: [{role, content}, ...]}
```

**–ú–µ—Ç–æ–¥—ã**:
- `get_history(user_id)` - –ø–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é, —Å–æ–∑–¥–∞—Ç—å –µ—Å–ª–∏ –Ω–µ—Ç, –ø—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±—Ä–µ–∑–∫—É
- `add_message(user_id, role, content)` - –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `clear_history(user_id)` - —É–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
- `_trim_history(history)` - –æ–±—Ä–µ–∑–∞—Ç—å –¥–æ MAX_CONTEXT_MESSAGES

**–õ–æ–≥–∏–∫–∞ –æ–±—Ä–µ–∑–∫–∏**:
```python
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å: system prompt + –ø–æ—Å–ª–µ–¥–Ω–∏–µ N*2 —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–∞—Ä—ã user+assistant)
# –ï—Å–ª–∏ MAX_CONTEXT_MESSAGES=2: system + –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Å–æ–æ–±—â–µ–Ω–∏—è
```

**–í–∞–∂–Ω–æ**: In-memory —Ö—Ä–∞–Ω–µ–Ω–∏–µ - –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏**:
- –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –ë–î: –∑–∞–º–µ–Ω–∏—Ç—å `dialogs: dict` –Ω–∞ DB repository
- –õ–æ–≥–∏–∫–∞ –æ–±—Ä–µ–∑–∫–∏: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `_trim_history()` —Å —Ä–∞–∑–Ω—ã–º–∏ MAX_CONTEXT_MESSAGES

---

## tests/ - –¢–µ—Å—Ç—ã

### conftest.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—â–∏–µ pytest fixtures

**Fixtures**:
- `config` - –º–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è Config —á–µ—Ä–µ–∑ monkeypatch
- `config_with_max_context` - Config —Å MAX_CONTEXT_MESSAGES=2
- `dialog_manager` - DialogManager —Å —Ç–µ—Å—Ç–æ–≤–æ–π Config
- `logger` - –º–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π structlog.BoundLogger

---

### tests/unit/

**Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**:

- `test_config.py` - —Ç–µ—Å—Ç—ã Config (–∑–∞–≥—Ä—É–∑–∫–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –¥–µ—Ñ–æ–ª—Ç—ã)
- `test_dialog_manager.py` - —Ç–µ—Å—Ç—ã DialogManager (–∏—Å—Ç–æ—Ä–∏—è, –æ–±—Ä–µ–∑–∫–∞)
- `test_llm_client.py` - —Ç–µ—Å—Ç—ã LLMClient (–º–æ–∫–∏ AsyncOpenAI)

---

### tests/integration/

**Integration-—Ç–µ—Å—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è**:

- `test_handler.py` - —Ç–µ—Å—Ç—ã MessageHandler —Å –º–æ–∫–∞–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## prompts/ - –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

### music_consultant.txt

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ä–æ–ª–∏ –±–æ—Ç–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è Config –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ `SYSTEM_PROMPT_FILE`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏**: –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π + –∏–∑–º–µ–Ω–∏—Ç—å .env

---

## docs/ - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### vision.md

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –≤–∏–¥–µ–Ω–∏–µ: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö, —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã

### roadmap.md

Roadmap –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ —Å–ø—Ä–∏–Ω—Ç–∞–º —Å –æ–±—â–∏–º –ø–ª–∞–Ω–æ–º —Ä–∞–∑–≤–∏—Ç–∏—è

### tasklists/

–î–µ—Ç–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã —Ä–∞–±–æ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞:
- `tasklist-s0.md` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–ø—Ä–∏–Ω—Ç–∞ 0 (MVP)
- `tasklist_tech_debt-s0.md` - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ —Å–ø—Ä–∏–Ω—Ç–∞ 0

### guides/

–ì–∞–π–¥—ã –¥–ª—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª - –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö)

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### pyproject.toml

**–°–æ–¥–µ—Ä–∂–∏—Ç**:
- `[project]` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `[tool.ruff]` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞/—Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞
- `[tool.mypy]` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ type checker
- `[tool.coverage]` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ coverage
- `[dependency-groups]` - dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### Makefile

**–ö–æ–º–∞–Ω–¥—ã**:
```makefile
make install    # uv sync
make run        # –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
make format     # ruff format
make lint       # ruff + mypy
make fix        # ruff --fix
make test       # pytest
make test-cov   # pytest + coverage
```

### .env.example

–®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `.env` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

---

## –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

| –ù—É–∂–Ω–æ... | –ò–¥–∏ –≤... |
|----------|----------|
| –ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –±–æ—Ç–∞ | `prompts/music_consultant.txt` |
| –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | `src/config.py` + `.env.example` |
| –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –±–æ—Ç–∞ | `src/handler.py` ‚Üí —Å–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ + –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å |
| –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å LLM | `.env` ‚Üí `OPENAI_MODEL` |
| –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ | `logs/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è |
| –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç | `tests/unit/` –∏–ª–∏ `tests/integration/` |
| –ò–∑–º–µ–Ω–∏—Ç—å –æ–±—Ä–µ–∑–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | `src/dialog_manager.py` ‚Üí `_trim_history()` |
| –°–º–µ–Ω–∏—Ç—å LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ | `.env` ‚Üí `OPENAI_BASE_URL` |

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- –ò–∑—É—á–∏—Ç—å [Data Model](03_data_model.md) –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ—á–∏—Ç–∞—Ç—å [Configuration & Secrets](05_configuration_secrets.md) –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å [Development Workflow](06_development_workflow.md) –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
