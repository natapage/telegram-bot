# Правила разработки кода

> **Полная техническая спецификация**: См. [vision.md](./vision.md)

## Основные принципы

### 1. KISS (Keep It Simple, Stupid)
- Максимальная простота, никакого оверинжиниринга
- Без преждевременной абстракции и оптимизации
- Прямые, понятные решения

### 2. Один класс = Один файл
- Строгое правило: 1 класс на 1 файл
- Имя файла соответствует имени класса (snake_case для файла, PascalCase для класса)
- Чёткое разделение ответственности

### 3. Async/Await
- Все I/O операции используют `async`/`await`
- Вызовы Telegram API: async
- Вызовы LLM API: async

### 4. Type Hints
- Обязательны для всех параметров функций
- Обязательны для всех возвращаемых значений
- Пример: `def process_message(user_id: int, text: str) -> str:`

### 5. Принципы качественного кода

**Single Responsibility**
- Один класс = одна ответственность (Config - только конфигурация, LLMClient - только работа с LLM)

**Dependency Injection**
- Передавай зависимости в `__init__()`, не создавай внутри класса
- Пример: `MessageHandler(llm_client, dialog_manager)` вместо создания внутри

**Fail Fast**
- Валидируй обязательные параметры в начале `__init__()`
- Выбрасывай исключение сразу, если что-то не так

**Explicit > Implicit**
- Избегай неявного поведения и скрытой магии
- Все зависимости и параметры должны быть видны явно

## Структура проекта

```
src/
├── main.py              # Точка входа
├── bot.py               # Класс Bot
├── handler.py           # Класс MessageHandler
├── llm_client.py        # Класс LLMClient
├── dialog_manager.py    # Класс DialogManager
└── config.py            # Класс Config
```

## Логгирование

- Использовать библиотеку `structlog`
- Уровни: INFO для событий, ERROR для ошибок
- Формат: `logger.info("message_received", user_id=user_id, text=text)`
- JSON формат логов

## Обработка ошибок

- Простые блоки try/except
- Понятные сообщения об ошибках для пользователя
- Полный traceback в логи

## Конфигурация

- Загрузка из `.env` через `python-dotenv`
- Доступ через класс `Config`
- Никаких захардкоженных значений

---

**Справка**: Полная архитектура, модели данных и сценарии в [vision.md](./vision.md)
