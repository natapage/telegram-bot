---
alwaysApply: true
---

# TDD Workflow –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç

> **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –≤–∏–¥–µ–Ω–∏–µ**: [vision.md](../../docs/vision.md)
> **–ü–ª–∞–Ω —Ä–∞–±–æ—Ç**: [tasklist.md](../../docs/tasklist.md)
> **–ü—Ä–∞–≤–∏–ª–∞ –∫–æ–¥–∞**: [conventions.mdc](./conventions.mdc)
> **–ü—Ä–∞–≤–∏–ª–∞ —Ç–µ—Å—Ç–æ–≤**: [qa_conventions.mdc](./qa_conventions.mdc)

## –ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Ç–µ—Ä–∞—Ü–∏–∏

### 1. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∑–∞–¥–∞—á–∏ —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∏–∑ `tasklist.md`
- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞
- **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–î–æ–∂–¥–∞—Ç—å—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è** –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π

### 2. TDD –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (Red-Green-Refactor)

#### üî¥ RED - Failing Test
1. –ù–∞–ø–∏—Å–∞—Ç—å failing —Ç–µ—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç ‚Üí —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ–Ω –ø–∞–¥–∞–µ—Ç
3. –ü–æ–∫–∞–∑–∞—Ç—å –∫—Ä–∞—Å–Ω—É—é –ø–æ–ª–æ—Å—É: `‚ùå Test FAILED`
4. **–°–¢–û–ü** - –¥–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞

#### üü¢ GREEN - Minimal Implementation
1. –ù–∞–ø–∏—Å–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç ‚Üí —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç
3. –ü–æ–∫–∞–∑–∞—Ç—å –∑–µ–ª–µ–Ω—É—é –ø–æ–ª–æ—Å—É: `‚úÖ Test PASSED`
4. –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É —á–µ–∫–±–æ–∫—Å–æ–º: `- [x]`

#### ‚ôªÔ∏è REFACTOR - Improve Code
1. –£–ª—É—á—à–∏—Ç—å –∫–æ–¥ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã ‚Üí —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø—Ä–æ—Ö–æ–¥—è—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä: `make lint`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å coverage: `make test-cov`

**–ü–æ–≤—Ç–æ—Ä—è—Ç—å —Ü–∏–∫–ª** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### 3. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤: `make test`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å coverage >= 80%: `make test-cov`
- –û–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞
- **–î–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4. –§–∏–∫—Å–∞—Ü–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ `tasklist.md`:
  - –°—Ç–∞—Ç—É—Å ‚Üí üü¢ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
  - –î–∞—Ç–∞ ‚Üí —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞
- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
- –ü–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- **–î–æ–∂–¥–∞—Ç—å—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è** –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

## –ü—Ä–∞–≤–∏–ª–∞

### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
- –í—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏ **—Å—Ç—Ä–æ–≥–æ –ø–æ –ø–æ—Ä—è–¥–∫—É** –∏–∑ `tasklist.md`
- **–°–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç, –ø–æ—Ç–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (TDD —Ü–∏–∫–ª)
- –°–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞—Ç—å failing —Ç–µ—Å—Ç –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫—Ä–∞—Å–Ω—É—é/–∑–µ–ª–µ–Ω—É—é –ø–æ–ª–æ—Å—É –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ü–∏–∫–ª–∞
- –û–¥–Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—è = –æ–¥–∏–Ω –∫–æ–º–º–∏—Ç
- –ñ–¥–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

### ‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ
- –ü–∏—Å–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–µ–∑ failing —Ç–µ—Å—Ç–∞
- –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å TDD —Ü–∏–∫–ª
- –ü–∏—Å–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ/–±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –û—Ç–∫–ª–æ–Ω—è—Ç—å—Å—è –æ—Ç `vision.md`, `conventions.md`, `qa_conventions.md`

## –®–∞–±–ª–æ–Ω –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

### –ü—Ä–∏ –Ω–∞—á–∞–ª–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏
```
–ò—Ç–µ—Ä–∞—Ü–∏—è N: [–ù–∞–∑–≤–∞–Ω–∏–µ]

–ü—Ä–µ–¥–ª–∞–≥–∞—é —Å–ª–µ–¥—É—é—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ:
[–û–ø–∏—Å–∞–Ω–∏–µ + –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞]

–ö—Ä–∏—Ç–∏—á–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- [–°–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π/–º–µ—Ç–æ–¥–æ–≤ –¥–ª—è TDD]

–°–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ–º?
```

### RED —Ñ–∞–∑–∞ (Failing Test)
```
üî¥ RED: Failing Test

–¢–µ—Å—Ç –¥–ª—è: [–æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞]

[–ö–æ–¥ —Ç–µ—Å—Ç–∞]

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞...
‚ùå Test FAILED: [–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏]

–ü—Ä–∏—á–∏–Ω–∞ –ø–∞–¥–µ–Ω–∏—è: [–æ–∂–∏–¥–∞–µ–º–æ, —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞]

–¢–µ—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω?
```

### GREEN —Ñ–∞–∑–∞ (Passing Test)
```
üü¢ GREEN: Minimal Implementation

[–ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏]

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞...
‚úÖ Test PASSED

–í—Å–µ —Ç–µ—Å—Ç—ã: ‚úÖ X passed

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç–ª–µ–º–µ–Ω—Ç—É?
```

### REFACTOR —Ñ–∞–∑–∞ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
```
‚ôªÔ∏è REFACTOR: –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–¥–∞

–ò–∑–º–µ–Ω–µ–Ω–∏—è:
- [–û–ø–∏—Å–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π]

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...
‚úÖ All tests PASSED

Lint: ‚úÖ No issues
Coverage: ‚úÖ X%

Refactoring –∑–∞–≤–µ—Ä—à–µ–Ω
```

### –ü–æ—Å–ª–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏
```
–ò—Ç–µ—Ä–∞—Ü–∏—è N –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

TDD —Ü–∏–∫–ª–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: X
–¢–µ—Å—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ: X
–§–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã: ‚úÖ All PASSED
Coverage: X%

–ì–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏?
```

## TDD Workflow –ø—Ä–∏–º–µ—Ä

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–¥–Ω–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

1. üìñ –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∏—Ç–µ—Ä–∞—Ü–∏—é N –∏–∑ tasklist.md
2. üí° –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ + –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è TDD
3. ‚è∏Ô∏è **–°–¢–û–ü** - –¥–æ–∂–¥–∞—Ç—å—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è

**TDD –¶–∏–∫–ª 1:**
4. üî¥ –ù–∞–ø–∏—Å–∞—Ç—å failing —Ç–µ—Å—Ç
5. üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å ‚ùå RED
6. ‚è∏Ô∏è **–°–¢–û–ü** - –¥–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
7. üü¢ –ù–∞–ø–∏—Å–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
8. üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å ‚úÖ GREEN
9. ‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É

**TDD –¶–∏–∫–ª 2 (–µ—Å–ª–∏ –µ—Å—Ç—å –µ—â–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª):**
10. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —à–∞–≥–∏ 4-9 –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞

**Refactor (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
11. ‚ôªÔ∏è –£–ª—É—á—à–∏—Ç—å –∫–æ–¥
12. üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã ‚Üí ‚úÖ GREEN
13. üìè make lint, make test-cov

**–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è:**
14. üß™ –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ + coverage
15. ‚è∏Ô∏è **–°–¢–û–ü** - –¥–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
16. üìä –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (üü¢, –¥–∞—Ç–∞)
17. üíæ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
18. üîí –°–¥–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç –ø–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
19. ‚è∏Ô∏è **–°–¢–û–ü** - —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏ N+1

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è TDD —Ü–∏–∫–ª–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  TDD CYCLE                                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ  üî¥ RED                                             ‚îÇ
‚îÇ  ‚îî‚îÄ Write failing test                             ‚îÇ
‚îÇ  ‚îî‚îÄ ‚ùå Test FAILED (expected)                       ‚îÇ
‚îÇ  ‚îî‚îÄ ‚è∏Ô∏è  Wait for confirmation                       ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚Üì                                                  ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  üü¢ GREEN                                           ‚îÇ
‚îÇ  ‚îî‚îÄ Write minimal implementation                   ‚îÇ
‚îÇ  ‚îî‚îÄ ‚úÖ Test PASSED                                  ‚îÇ
‚îÇ  ‚îî‚îÄ Continue to next feature or refactor           ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚Üì                                                  ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚ôªÔ∏è  REFACTOR (optional)                            ‚îÇ
‚îÇ  ‚îî‚îÄ Improve code quality                           ‚îÇ
‚îÇ  ‚îî‚îÄ ‚úÖ All tests still PASSED                       ‚îÇ
‚îÇ  ‚îî‚îÄ Check lint & coverage                          ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚Üì                                                  ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  üîÑ Repeat for next feature                        ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ü—Ä–∏–º–µ—Ä—ã Red/Green –ø–æ–ª–æ—Å

### –ü—Ä–∏–º–µ—Ä 1: DialogManager.get_history()

**üî¥ RED:**
```python
def test_get_history_creates_new_history_with_system_prompt(dialog_manager, config):
    """–¢–µ—Å—Ç: get_history() —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º"""
    user_id = 12345

    history = dialog_manager.get_history(user_id)

    assert len(history) == 1
    assert history[0]["role"] == "system"
```

–ó–∞–ø—É—Å–∫: `pytest tests/unit/test_dialog_manager.py::test_get_history_creates_new_history_with_system_prompt`

```
‚ùå FAILED tests/unit/test_dialog_manager.py::test_get_history_creates_new_history_with_system_prompt
AttributeError: 'DialogManager' object has no attribute 'get_history'
```

**üü¢ GREEN:**
```python
class DialogManager:
    def __init__(self, config: Config) -> None:
        self.config = config
        self.dialogs: dict[int, list[dict[str, Any]]] = {}

    def get_history(self, user_id: int) -> list[dict[str, Any]]:
        if user_id not in self.dialogs:
            self.dialogs[user_id] = [{"role": "system", "content": self.config.SYSTEM_PROMPT}]
        return self.dialogs[user_id]
```

–ó–∞–ø—É—Å–∫: `pytest tests/unit/test_dialog_manager.py::test_get_history_creates_new_history_with_system_prompt`

```
‚úÖ PASSED tests/unit/test_dialog_manager.py::test_get_history_creates_new_history_with_system_prompt
```

### –ü—Ä–∏–º–µ—Ä 2: DialogManager.add_message()

**üî¥ RED:**
```python
def test_add_message_appends_to_history(dialog_manager):
    """–¢–µ—Å—Ç: add_message() –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é"""
    user_id = 12345

    dialog_manager.add_message(user_id, "user", "Hello")
    history = dialog_manager.get_history(user_id)

    assert len(history) == 2  # system + user
    assert history[1]["role"] == "user"
    assert history[1]["content"] == "Hello"
```

```
‚ùå FAILED tests/unit/test_dialog_manager.py::test_add_message_appends_to_history
AttributeError: 'DialogManager' object has no attribute 'add_message'
```

**üü¢ GREEN:**
```python
def add_message(self, user_id: int, role: str, content: str) -> None:
    history = self.get_history(user_id)
    history.append({"role": role, "content": content})
```

```
‚úÖ PASSED tests/unit/test_dialog_manager.py::test_add_message_appends_to_history
‚úÖ All tests: 2 passed
```

## –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞

### –ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
```bash
make format    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make lint      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (0 –æ—à–∏–±–æ–∫)
make test      # –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
make test-cov  # Coverage >= 80%
```

### –ú–µ—Ç—Ä–∏–∫–∏ TDD
- –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ ‚Üí –º–∏–Ω–∏–º—É–º 1 —Ç–µ—Å—Ç
- –ö—Ä–∏—Ç–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤ (success, edge cases, errors)
- Coverage –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ >= 90%
- –û–±—â–∏–π coverage >= 80%

---

**–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ TDD**: –ö—Ä–∞—Å–Ω—ã–π ‚Üí –ó–µ–ª–µ–Ω—ã–π ‚Üí –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥. –ë–µ–∑ —Ç–µ—Å—Ç–∞ –Ω–µ—Ç –∫–æ–¥–∞!
